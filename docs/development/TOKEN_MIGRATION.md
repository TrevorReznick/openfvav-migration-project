# Token Migration System

Questo sistema di migrazione dei token Ã¨ progettato per estrarre, convertire e generare dinamicamente i file `tokens.ts` partendo dai file JSON di migrazione e utilizzando gli extractor esistenti.

## ğŸ¯ Obiettivo

Generare un file `tokens.ts` corretto e completo che:
- Estrae i dati dai file JSON in `src/migration/design-system/tokens/`
- Applica le conversioni necessarie (es. hex â†’ HSL per i colori)
- Utilizza gli extractor CSS esistenti per trovare token aggiuntivi
- Applica le mappature statiche definite nel fix
- Genera TypeScript types e helper functions

## ğŸ“ Struttura dei file

```
migration-dev-V0/
â”œâ”€â”€ src/migration/design-system/tokens/
â”‚   â”œâ”€â”€ colors.json      # Colori in vari formati (hex, hsl, etc.)
â”‚   â”œâ”€â”€ spacing.json     # Valori di spacing
â”‚   â””â”€â”€ typography.json  # Configurazione tipografica
â”œâ”€â”€ src/lib/
â”‚   â””â”€â”€ tokens.ts        # File generato dinamicamente
â””â”€â”€ scripts/
    â”œâ”€â”€ migrate-tokens-simple.js      # Script base con mappature statiche
    â”œâ”€â”€ migrate-tokens-dynamic.js     # Script dinamico con extractor
    â””â”€â”€ migrate-tokens-integrated.js  # Script integrato completo
```

## ğŸš€ Utilizzo

### 1. Generazione Rapida (solo tokens.ts)

```bash
npm run migrate:tokens:quick
```

Genera solo il file `tokens.ts` utilizzando gli extractor e le conversioni dinamiche.

### 2. Generazione Dinamica

```bash
npm run migrate:tokens:dynamic
```

Simile alla generazione rapida ma con piÃ¹ logging e opzioni di debug.

### 3. Migrazione Completa

```bash
npm run migrate:tokens:full
```

Esegue la migrazione completa utilizzando tutti gli script CLI esistenti:
1. `npm run migrate:colors` - Migra i colori usando lo script CLI
2. `npm run migrate:typography` - Migra la tipografia usando lo script CLI  
3. `npm run migrate:tokens:dynamic` - Genera il file tokens.ts
4. Verifica il risultato

### 4. Script Base (statico)

```bash
npm run migrate:tokens
```

Utilizza solo le mappature statiche definite nel fix, senza extractor dinamici.

## ğŸ”§ Come funziona il sistema dinamico

### 1. Estrazione da JSON
Il sistema legge i file JSON:
- `colors.json` - Colori in vari formati
- `spacing.json` - Valori di spacing  
- `typography.json` - Configurazione tipografica

### 2. Conversione Colori
I colori vengono convertiti dinamicamente:
- **Hex** â†’ HSL: `#7C3AED` â†’ `270 81% 60%`
- **RGBA** â†’ HSL: `rgba(124, 58, 237, 0.5)` â†’ `270 81% 60% / 0.5`
- **HSL esistente** â†’ Pulizia del formato
- **Fallback** â†’ Valore originale se la conversione fallisce

### 3. Mappature Statiche (Fix)
Vengono applicate le mappature definite nel fix:
```javascript
const COLOR_MAPPINGS = {
  'primary': '262 83% 58%',
  'secondary': '217 33% 17%',
  // ... altre mappature
};
```

### 4. Extraction CSS Aggiuntivo
Il sistema cerca anche nei file CSS esistenti (`globals.css`, `tokens.css`, `index.css`) per trovare token aggiuntivi non presenti nei JSON.

### 5. Generazione TypeScript
Viene generato il file `tokens.ts` con:
- Typescript types (`ColorToken`, `SpacingToken`, `TypographyToken`)
- Helper functions (`getColor()`, `getSpacing()`, `getTypography()`)
- Export individuali e raggruppati

## ğŸ“Š Output Esempio

```typescript
// Auto-generated design tokens
// Generated on: 2025-11-30T09:24:29.912Z
// Generated by: dynamic migration system

const colors = {
  "primary": "262 83% 58%",
  "secondary": "217 33% 17%",
  // ... altri colori
} as const;

const typography = {
  "fontFamily": {
    "base": "\"Inter\", system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto",
    "mono": "ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas"
  },
  "fontSize": {
    "base": "1rem",
    "lg": "1.125rem", 
    "sm": "0.875rem"
  }
} as const;

const spacing = {
  "0": "0",
  "1": "0.25rem",
  "2": "0.5rem",
  // ... altri valori
} as const;

// Types e helper functions
export type ColorToken = keyof typeof colors;
export const getColor = (key: keyof typeof colors) => `var(--color-${key})`;
// ...
```

## ğŸ” Troubleshooting

### File non trovati
```bash
npm run validate  # Verifica la struttura del progetto
```

### Errori di conversione colori
Controlla il formato dei colori in `colors.json`:
- Hex: `#RRGGBB` o `RRGGBB`
- RGBA: `rgba(r, g, b, a)`
- HSL: `hsl(h, s%, l%)`

### Token mancanti
1. Verifica che i file JSON contengano tutti i token necessari
2. Controlla che i file CSS contengano le CSS variables corrette
3. Usa la migrazione completa per estrarre da tutte le fonti

## ğŸ›ï¸ Configurazione

### Modificare le mappature statiche
Edita `scripts/migrate-tokens-dynamic.js`:
```javascript
const COLOR_MAPPINGS = {
  'primary': '262 83% 58%',  // Modifica questo valore
  // ...
};
```

### Aggiungere nuovi formati di conversione
Estendi la funzione `convertColors()` nel dynamic script per supportare nuovi formati.

## ğŸ”„ Workflow consigliato

1. **Sviluppo**: Usa `npm run migrate:tokens:quick` per generazioni rapide
2. **Testing**: Usa `npm run migrate:tokens:dynamic` per piÃ¹ dettagli
3. **Produzione**: Usa `npm run migrate:tokens:full` per migrazione completa
4. **Verifica**: Controlla sempre il file `src/lib/tokens.ts` generato

## ğŸ“ˆ Performance

- **Quick**: ~2 secondi (solo JSON â†’ tokens.ts)
- **Dynamic**: ~3 secondi (con extraction CSS)
- **Full**: ~10-15 secondi (migrazione completa CLI)

Il sistema Ã¨ ottimizzato per essere veloce durante lo sviluppo e completo per la produzione.
